<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Causal inference for decision-making in growth hacking and upselling in Python | georg.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Causal inference for decision-making in growth hacking and upselling in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this article we discuss differences between experimental and observational data and pitfalls in using the latter for data-driven decision-making." />
<meta property="og:description" content="In this article we discuss differences between experimental and observational data and pitfalls in using the latter for data-driven decision-making." />
<link rel="canonical" href="https://georg.io/2021/08/18/Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python" />
<meta property="og:url" content="https://georg.io/2021/08/18/Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python" />
<meta property="og:site_name" content="georg.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-18T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"In this article we discuss differences between experimental and observational data and pitfalls in using the latter for data-driven decision-making.","url":"https://georg.io/2021/08/18/Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python","@type":"BlogPosting","headline":"Causal inference for decision-making in growth hacking and upselling in Python","dateModified":"2021-08-18T00:00:00-05:00","datePublished":"2021-08-18T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://georg.io/2021/08/18/Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://georg.io/feed.xml" title="georg.io" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45212489-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45212489-1');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">georg.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Causal inference for decision-making in growth hacking and upselling in Python</h1><p class="page-description">In this article we discuss differences between experimental and observational data and pitfalls in using the latter for data-driven decision-making.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-18T00:00:00-05:00" itemprop="datePublished">
        Aug 18, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      15 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#dowhy">dowhy</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#causal inference">causal inference</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/waltherg/georgio_fastpages/tree/master/_notebooks/2021-08-18-Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/waltherg/georgio_fastpages/master?filepath=_notebooks%2F2021-08-18-Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/waltherg/georgio_fastpages/blob/master/_notebooks/2021-08-18-Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h2"><a href="#Let's-estimate-the-average-treatment-effect-and-make-a-decision!">Let&#39;s estimate the average treatment effect and make a decision! </a></li>
<li class="toc-entry toc-h2"><a href="#References-and-further-material-...">References and further material ... </a></li>
<li class="toc-entry toc-h2"><a href="#Install-and-load-libraries">Install and load libraries </a></li>
<li class="toc-entry toc-h2"><a href="#Randomized-controlled-trial-/-experimental-data">Randomized controlled trial / experimental data </a></li>
<li class="toc-entry toc-h2"><a href="#Average-treatment-effect-on-post-signup-spend-for-experimental-data">Average treatment effect on post-signup spend for experimental data </a></li>
<li class="toc-entry toc-h2"><a href="#The-issue-with-randomized-controlled-trials-and-observational-data">The issue with randomized controlled trials and observational data </a></li>
<li class="toc-entry toc-h2"><a href="#Identification-/-identifying-the-causal-effect">Identification / identifying the causal effect </a></li>
<li class="toc-entry toc-h2"><a href="#Estimating-the-treatment-effect">Estimating the treatment effect </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-08-18-Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h2>
<p>Wow, growth hacking <em>and</em> upselling all in the same article? Also Python.</p>
<p>Okay, let's start at the beginning. Imagine the following scenario: You're responsible for increasing the amount of money users spend on your e-commerce platform.</p>
<p>You and your team come up with different measures you could implement to achieve your goal. Two of these measures could be:</p>
<ul>
<li>Provide a discount on your best-selling items,</li>
<li>Implement a rewards program that incentivices repeat purchases.</li>
</ul>
<p>Both of these measures are fairly complex with each incurring a certain, probably known, amount of cost and an unknown effect on your customers' spending behaviour.</p>
<p>To decide which of these two possible measures is worth both the effort and incurred cost you need to estimate their effect on customer spend.</p>
<p>A natural way of estimating this effect is computing the following:</p>
<p>$\textrm{avg}(\textrm{spend} | \textrm{treatment} = 1) - \textrm{avg}(\textrm{spend} | \textrm{treatment} = 0) = \textrm{ATE}$.</p>
<p>Essentially you would compute the average spend of users who received the treatment (received a discount or signed up for rewards) and subtract from that the average spend of users who didn't receive the treatment.</p>
<p>Without discussing the details of the underlying potential outcomes framework, the above expression is called the average treatment effect (ATE).</p>
<h2 id="Let's-estimate-the-average-treatment-effect-and-make-a-decision!">
<a class="anchor" href="#Let's-estimate-the-average-treatment-effect-and-make-a-decision!" aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's estimate the average treatment effect and make a decision!<a class="anchor-link" href="#Let's-estimate-the-average-treatment-effect-and-make-a-decision!"> </a>
</h2>
<p>So now we'll just analyze our e-commerce data of treated and untreated customers and compute the average treatment effect (ATE) for each proposed measure, right? Right?</p>
<p>Before you rush ahead with your ATE computations - now is a good time to take a step back and contemplate how your data was generated in the first place(data-generating process).</p>
<h2 id="References-and-further-material-...">
<a class="anchor" href="#References-and-further-material-..." aria-hidden="true"><span class="octicon octicon-link"></span></a>References and further material ...<a class="anchor-link" href="#References-and-further-material-..."> </a>
</h2>
<p>Before we continue: My example here is based on a tutorial by the authors of the excellent DoWhy library. You can find the original tutorial here:</p>
<p><a href="https://github.com/microsoft/dowhy/blob/master/docs/source/example_notebooks/dowhy_example_effect_of_memberrewards_program.ipynb">https://github.com/microsoft/dowhy/blob/master/docs/source/example_notebooks/dowhy_example_effect_of_memberrewards_program.ipynb</a></p>
<p>And more on DoWhy here: <a href="https://microsoft.github.io/dowhy/">https://microsoft.github.io/dowhy/</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install-and-load-libraries">
<a class="anchor" href="#Install-and-load-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install and load libraries<a class="anchor-link" href="#Install-and-load-libraries"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install dowhy --quiet
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Randomized-controlled-trial-/-experimental-data">
<a class="anchor" href="#Randomized-controlled-trial-/-experimental-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Randomized controlled trial / experimental data<a class="anchor-link" href="#Randomized-controlled-trial-/-experimental-data"> </a>
</h2>
<p>So where were we ... ah right! Where does our e-commerece data come from?</p>
<p>Since we don't actually run an e-commerce operation here we will have to simulate our data (remember: these ideas are based on the above DoWhy tutorial).</p>
<p>Imagine we observe the monthly spend of each of our 10,000 users over the course of a year. Each user will spend with a certain distribution (here, a Poisson distribution) and there are both high and low spenders with different mean spends.</p>
<p>Over the course of the year, each user can sign up to our rewards program in any month and once they have signed up their spend goes up by 50% relative to what they would've spent without signing up.</p>
<p>So far so mundane: Different customers show different spending behaviour and signing up to our rewards program increases their spend.</p>
<p>Now the big question is: How are treatment assignment (rewards program signup) and outcome (spending behaviour) related?</p>
<p>If treatment and outcome, interpreted as random variables, are independent of one another then according to the potential outcome framework we can compute the ATE as easily as shown above:</p>
<p>$\textrm{ATE} = \textrm{avg}(\textrm{spend} | \textrm{treatment} = 1) - \textrm{avg}(\textrm{spend} | \textrm{treatment} = 0)$</p>
<p>When are treatment and outcome independent? The gold standard for achieving their independence in a data set is the randomized controlled trial (RCT).</p>
<p>In our scenario what an RCT would look like is randomly signing up our users to our rewards program - indepndent of their spending behaviour or any other characteristic.</p>
<p>So we would go through our list of 10,000 users and flip a coin for each of them, sign them up to our program in a random month of the year based on our coin, and send them on their merry way to continue buying stuff in our online shop.</p>
<p>Let's put all of this into a bit of code that simulates the spending behaviour of our users according to our thought experiment:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_users</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">num_months</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'user_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_users</span><span class="p">),</span> <span class="n">num_months</span><span class="p">),</span>
    <span class="s1">'month'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_months</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">num_users</span><span class="p">),</span> <span class="c1"># months are from 1 to 12</span>
    <span class="s1">'high_spender'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_users</span><span class="p">),</span> <span class="n">num_months</span><span class="p">),</span>
<span class="p">})</span>

<span class="n">df</span><span class="p">[</span><span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">"spend"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"spend"</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">"month"</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>

<span class="n">signup_months</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_months</span><span class="p">),</span>
    <span class="n">num_users</span>
<span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_users</span><span class="p">)</span>  <span class="c1"># signup_months == 0 means customer did not sign up</span>

<span class="n">df</span><span class="p">[</span><span class="s1">'signup_month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">signup_months</span><span class="p">,</span> <span class="n">num_months</span><span class="p">)</span>

<span class="c1"># A customer is in the treatment group if and only if they signed up</span>
<span class="n">df</span><span class="p">[</span><span class="s2">"treatment"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"signup_month"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># Simulating a simple treatment effect of 50%</span>
<span class="n">after_signup</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"signup_month"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s2">"month"</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"treatment"</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">after_signup</span><span class="p">,</span> <span class="s2">"spend"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">after_signup</span><span class="p">][</span><span class="s2">"spend"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's look at user <code>0</code> and their treatment assignment as well as spend (since we're sampling random variables here you'll see something different from me):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>month</th>
      <th>high_spender</th>
      <th>spend</th>
      <th>signup_month</th>
      <th>treatment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>235</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>249</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>224</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>184</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>172</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>182</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>155</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>9</td>
      <td>0</td>
      <td>120</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>153</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>11</td>
      <td>0</td>
      <td>148</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>12</td>
      <td>0</td>
      <td>159</td>
      <td>0</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Average-treatment-effect-on-post-signup-spend-for-experimental-data">
<a class="anchor" href="#Average-treatment-effect-on-post-signup-spend-for-experimental-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Average treatment effect on post-signup spend for experimental data<a class="anchor-link" href="#Average-treatment-effect-on-post-signup-spend-for-experimental-data"> </a>
</h2>
<p>The effect we're interested in is the impact of rewards signup on spending behaviour - i.e. the effect on post-signup spend.</p>
<p>Since customers can sign up any month of the year, we'll choose one month at random and compute the effect with respect to that one month.</p>
<p>So let's create a new table from our time series where we collect post-signup spend for those customers that signed up in <code>month = 6</code> alongside the spend of customers who never signed up.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">month</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">post_signup_spend</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">signup_month</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">month</span><span class="p">])]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"signup_month"</span><span class="p">,</span> <span class="s2">"treatment"</span><span class="p">])</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">"post_spend"</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="n">month</span><span class="p">,</span> <span class="s2">"spend"</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">post_signup_spend</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>      user_id  signup_month  treatment  post_spend
0           0             0      False  152.833333
1           3             0      False  162.166667
2           4             0      False  146.333333
3           6             0      False  153.666667
4           7             6       True  240.750000
...       ...           ...        ...         ...
5451     9990             0      False  629.833333
5452     9993             0      False  674.500000
5453     9994             0      False  681.000000
5454     9995             0      False  641.333333
5455     9998             0      False  658.833333

[5456 rows x 4 columns]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To get the average treatment effect (ATE) of our rewards signup treatment we now compute the average post-signup spend of the customers who signed up and subtract from that the average spend of users who didn't sign up:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span> <span class="o">=</span> <span class="n">post_signup_spend</span>\
  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'treatment'</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">'post_spend'</span><span class="p">:</span> <span class="s1">'mean'</span><span class="p">})</span>

<span class="n">post_spend</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>post_spend</th>
    </tr>
    <tr>
      <th>treatment</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>403.512239</td>
    </tr>
    <tr>
      <th>True</th>
      <td>610.140371</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So the ATE of rewards signup on post-signup spend is:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span> <span class="o">-</span> <span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>206.62813242372852</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since we simulated the treatment effect ourselves (50% post-signup spend increase) let's see if we can recover this effect from our data:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span> <span class="o">/</span> <span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1.5120740154875112</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The post-signup spend for treated customers is roughly 50% greater than the spend for untreated customers - exactly the treatment effect we simulated!</p>
<p>Remember, however, that we are dealing with clean experimental data from a randomized controlled trial (RCT) here! The potential outcome framework tells us that for data from an RCT the simple ATE formula we used here yields the correct treatment effect due to independence of treatment assignment and outcome.</p>
<p>So the fact that we recovered the actual (simulated) treatment effect is nice to see but not surprising.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-issue-with-randomized-controlled-trials-and-observational-data">
<a class="anchor" href="#The-issue-with-randomized-controlled-trials-and-observational-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>The issue with randomized controlled trials and observational data<a class="anchor-link" href="#The-issue-with-randomized-controlled-trials-and-observational-data"> </a>
</h2>
<p>Our above thought experiment where we randomly assigned our customers to our rewards program isn't very realistic.</p>
<p>Randomly signing up paying customers to rewards programs without their consent may upset some and may not even be permissible. The same issue with randomized treatment assignment pops up everywhere - clean randomized controlled trials are oftentimes too expensive, infeasible to implement, unethical, or not permitted.</p>
<p>But since we still need to experiment with our shop to drive spending behaviour we'll still go ahead and implement our rewards program. Only that this time we'll place a regular signup page in our shop where our customers can decide for themselves if they want to sign up or not.</p>
<p>Activating our signup page and simply observing how users and their spend behaves gives us <strong>observational data</strong>.</p>
<p>We usually call "observational data" just "data" without giving much thought to where they came from. I mean we've all dealt with lots of different kinds of data (marketing data, R&amp;D measurements, HR data, etc.) and all these data were simply "observed" and didn't come out of a carefully set up experiment.</p>
<p>Simulating our observational data we've got the same 10,000 customers over a span of a year. We still have the same high and low spenders.</p>
<p>Only that now our high spenders are far more likely to sign up to our rewards program than our low spenders. My reasoning for this is that customers who spend more are also more likely to show greater brand loyalty towards us and our rewards program. Further, they visit our shop more frequently hence are more likely to notice our new rewards program and the signup page. We could also add this behaviour as random variables to our simulation below but just take a shortcut and give low spenders a 5% chance of signing up and high spenders a 95% chance.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_users</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">num_months</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'user_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_users</span><span class="p">),</span> <span class="n">num_months</span><span class="p">),</span>
    <span class="s1">'month'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_months</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">num_users</span><span class="p">),</span> <span class="c1"># months are from 1 to 12</span>
    <span class="s1">'high_spender'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_users</span><span class="p">),</span> <span class="n">num_months</span><span class="p">),</span>
<span class="p">})</span>

<span class="n">df</span><span class="p">[</span><span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'spend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">signup_months</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'user_id'</span><span class="p">,</span> <span class="s1">'high_spender'</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">signup_months</span><span class="p">[</span><span class="s1">'signup_month'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">signup_months</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'signup_month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_months</span><span class="p">),</span>
    <span class="p">(</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">signup_months</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'signup_month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_months</span><span class="p">),</span>
    <span class="p">(</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">signup_months</span><span class="p">[</span><span class="s1">'high_spender'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">signup_months</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s2">"treatment"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"signup_month"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="n">after_signup</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"signup_month"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="s2">"month"</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"treatment"</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">after_signup</span><span class="p">,</span> <span class="s2">"spend"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">after_signup</span><span class="p">][</span><span class="s2">"spend"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.5</span>

<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>month</th>
      <th>high_spender</th>
      <th>spend</th>
      <th>signup_month</th>
      <th>treatment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>778</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>726</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>704</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>723</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>5</td>
      <td>1</td>
      <td>718</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>119995</th>
      <td>9999</td>
      <td>8</td>
      <td>1</td>
      <td>745</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>119996</th>
      <td>9999</td>
      <td>9</td>
      <td>1</td>
      <td>777</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>119997</th>
      <td>9999</td>
      <td>10</td>
      <td>1</td>
      <td>776</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>119998</th>
      <td>9999</td>
      <td>11</td>
      <td>1</td>
      <td>744</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>119999</th>
      <td>9999</td>
      <td>12</td>
      <td>1</td>
      <td>768</td>
      <td>0</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>120000 rows Ã— 6 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now imagine you weren't aware of causality, confounders, high / low spenders, and all that. You simply published your rewards signup page and observed your customers' spending behaviour over a span of a year. Chances are you'll compute the average treatment effect the exact same way we did above for our randomized controlled trial:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">month</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">post_signup_spend</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">signup_month</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">month</span><span class="p">])]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"signup_month"</span><span class="p">,</span> <span class="s2">"treatment"</span><span class="p">])</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">"post_spend"</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="n">month</span><span class="p">,</span> <span class="s2">"spend"</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                <span class="s2">"pre_spend"</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="n">month</span><span class="p">,</span> <span class="s2">"spend"</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">post_signup_spend</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>      user_id  signup_month  treatment  post_spend  pre_spend
0           1             0      False  251.666667      239.0
1           3             0      False  246.166667      252.8
2           4             0      False  740.833333      737.2
3           6             0      False  254.333333      247.0
4           7             0      False  249.166667      253.2
...       ...           ...        ...         ...        ...
5499     9992             0      False  246.000000      240.6
5500     9995             0      False  254.833333      256.4
5501     9996             0      False  248.833333      239.8
5502     9997             0      False  249.500000      247.8
5503     9999             0      False  761.666667      752.6

[5504 rows x 5 columns]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span> <span class="o">=</span> <span class="n">post_signup_spend</span>\
  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'treatment'</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">'post_spend'</span><span class="p">:</span> <span class="s1">'mean'</span><span class="p">})</span>

<span class="n">post_spend</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>post_spend</th>
    </tr>
    <tr>
      <th>treatment</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>275.891760</td>
    </tr>
    <tr>
      <th>True</th>
      <td>1075.543699</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span> <span class="o">-</span> <span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>799.6519394104552</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span> <span class="o">/</span> <span class="n">post_spend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="s1">'post_spend'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3.8984263250854134</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Performing the exact same computation as above, now we're estimating an average treatment effect of almost 400% instead of the actual 50%!</p>
<p>So what went wrong here?</p>
<p>Observational data got us!</p>
<p>Realize that in our observational data the outcome (spend) is not indepndent of treatment assignmnet (rewards program signup): High spenders are far more likely to sign up hence are overrepresented in our treatment group while low spenders are overrepresented in our control group (users that didn't sign up).</p>
<p>So when we compute the above difference or ratio we don't just see the average treatment effect of rewards signup we also see the inherent difference in spending between high and low spenders.</p>
<p>So if we ignore how our observational data are generated we'll overestimate the effect our rewards program has and likely make decisions that seem to be supported by data but in reality aren't.</p>
<p>Also notice that we often make this same mistake when training machine learning algorithms on observational data. Chances are someone will ask you to train a regression model to predict the effectiveness of the rewards program and your model will end up with the same inflated estimate as above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So how do we fix this? And how can we estimate the true treatment effect from our observational data?</p>
<p>Generally, we know from experience in e-commerece that people who tend to spend more are more likely to sign up to our rewards program. So we could segment our users into spend buckets and compute the treatment effect within each bucket to try and breeak this confounding link in our observational data.</p>
<p>Notice that in practice we won't have a <code>high spender</code> flag for our customers so we'll have to go by our customers' observed spending behaviour.</p>
<p>The causal inference framework offers an established approach here: Relying on our domain knowledge, we define a causal model that describes how we believe our observational data were generated.</p>
<p>Let's draw this as a graph with nodes and edges:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">"../../../"</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">dowhy</span>

<span class="n">causal_graph</span> <span class="o">=</span> <span class="s2">"""digraph {</span>
<span class="s2">treatment[label="Program Signup in month i"];</span>
<span class="s2">pre_spend;</span>
<span class="s2">post_spend;</span>
<span class="s2">U[label="Unobserved Confounders"]; </span>
<span class="s2">pre_spend -&gt; treatment;</span>
<span class="s2">pre_spend -&gt; post_spend;</span>
<span class="s2">treatment-&gt;post_spend;</span>
<span class="s2">U-&gt;treatment; U-&gt;pre_spend; U-&gt;post_spend;</span>
<span class="s2">}"""</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">dowhy</span><span class="o">.</span><span class="n">CausalModel</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">post_signup_spend</span><span class="p">,</span>
    <span class="n">graph</span><span class="o">=</span><span class="n">causal_graph</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">),</span>
    <span class="n">treatment</span><span class="o">=</span><span class="s2">"treatment"</span><span class="p">,</span>
    <span class="n">outcome</span><span class="o">=</span><span class="s2">"post_spend"</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">view_model</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV0AAADnCAYAAAC9roUQAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAgAElEQVR4nO3dd5ycZbn/8c83m0oJoQmEFggoJQmEHoRDEUGaWAIiEgGpAvLzcDyK0qVERUSagvSiIpGjB0QOSEcgIB0SKYEEEgwiJUQMhJTv74/rCUxiNrvZnZ1nduZ6v177yu7MM89cs9m99pr7ue/rlm1SSinVRo+yA0gppWaSSTellGook25KKdVQJt2UUqqhTLoppVRDmXRTSqmGMummlFINZdJNKaUayqSbUko1lEk3pZRqKJNuSinVUCbdlFKqoUy6KaVUQ5l0U0qphjLppm5EQ0EXgsaDZoJc/Du+uH1o2RGm1BZlP91U/7Q2cA2wMdAHaFnIQbOBD4DHga+CX6pdfCm1XybdVOe0N3AlrSfbBc0BZgIHgsd0XVwpdUwm3VTHtDdwFdCvAw9+DzggE2+qN5l0U53S2sDTwBKdOMkMYAh4YnViSqnz8kJaqlfXEEMKndGnOE9KdSOTbqpDGkZcNJtvDFeCCRPmP/KUU2D//Vs9UQswPGc1pHqSSTfVo8PpfJU7T+/ifCnVhUy6qR7tQPtmKrRHz+J8KdWFTLqpHg2u8vnWqfL5UuqwTLqpHvWu8vl6Vfl8KXVYJt1Ujz5Y2I0tLTBr1vy3zZoFvdpOqbPaPCKlGsmkm+rRiwu7cY01YNKk+W+bOBHWXLPN801o84iUaiSTbqpHdxG9FObzpS/B6afDlCkwdy7cfjvcdBOMHLnIc80uzpdSXcgVaakOadjcuTzUowd9K2997z046SQYMwbefhsGD455up/97CJPNgPYCvx0FwacUrtl0k11RVJP4NixYzlj883p0aNHx9+NzZmD587loV69PKKKIabUKTm8kOqGpI2Ah4Cd776bnXr04P3OnG/2bOZssAFrSNqtOhGm1HlZ6abSSeoDnECsHDsOuMK2q9FlTOIt4BLgAeCbtt+oUtgpdUhWuqlUkrYmGo8PATa2fbk/rAQ8BjiAGJed085TzimOPwA8xvYdwFDgdeBpSV+SpOq+ipTaLyvdVApJSwFnAPsAxwC/das/jFobuBoYTiyc6LmQgyp3jhi1sHaOkrYCLiOmkB1p+9VOv5CUFlNWuqnmJH2a6JU7ABhie0zrCRdi6x1vA2wFXAyMnzkTikd8AIwvbt8qjlt4/1zbY4FNgCeAJyQdmlVvqrWsdFPNSFoWOBv4FHCE7Vs6ca6/AZvZ/lsHHz+MqHr/CRxqe6ELMlKqtqx0U01I+jzwDMVuDp1JuNVg+ylgBPBH4CFJx0qqVmezlFqVlW7qUpJWBs4HhgGH2L6vSuftVKW7wLnWAS4lZkkcbPuZzp4zpdZkpZu6hMIBwJPEhauNqpVwq832BGBHYrjhLkknS6p2p7OUgKx0UxeQtCZxYWslonJ8rAueo2qV7gLnXQ24CFiTiP3hap4/pax0U9VI6iHpaOBR4F5gi65IuF3J9hRgT+BM4EZJP5bUmR2JU5pPJt1UFZI+QSTaLwPb2D7TdrfsY+vwa2JRxUDgKUm55U+qiky6qVMk9ZL0XeB+4DpgW9vPlhxWVdj+h+39gP8ErpZ0saRlyo4rdW+ZdFOHSRoOPAxsT4yvXmB7brlRVZ/tm4hlygaekbRnySGlbiyTblpskvpKGg3cCvwU+IztSeVG1bVsv2P7COCrwDmSfi1pxbLjSt1PJt20WCRtQ0wDWxcYZvuqRS/hbSy27yLmHE8hGujsl0uJ0+LIKWOpXSQtDYwGvgB8w/YNJcfTJVPGFjOGzYm5va8AX7c9uaxYUveRlW5qk6RdiAY1SwAblp1w64XtvwCbEePaj0k6XFL+TqVFyko3tUrS8sBPgO2Aw2zfVnJIH6qHSreSpA2Jqvd9ooHOCyWHlOpU/lVO/6ZYwjuSqG6nEQ1q6ibh1iPb44BPAv8LPCjpv4v93lKaT1a6aT6SVgEuBNYnGtTcX3JIC1VvlW4lSWsTWwT1J5YSP1VySKmOZKWbgA+r24OImQnjgeH1mnDrne2XgJ2IHg53SPp+sQ9cSpl0E0haC7gNOBrY2fYJtju1E2+zK5YSXwZsREwxe6zYLig1uUy6TUxSi6RjgL8AtwNb2n6i5LAaSjH88XngVOB3ks6RtGTJYaUSZdJtUpI2AO4DRgJb2/6h7dklh9WQiqr3emIp8QrEooqdSg4rlSSTbpMpGtScQHQEuxbY3vbzJYfVFGy/aXsUMYxzuaTLJA0oO65UW5l0m4ikTYFHgK2BTWz/rBEb1NQ7238kqt73gXGSPldySKmGMuk2AUn9JP2Q2ITxLGB326+UHFZTsz3d9lFE/+EfSbpe0kplx5W6XibdBifpP4hpYIOAobavbaYGNfXO9r3EDIeXiGbpo7KBTmPLxRENSlJ/4AfAZ4Gjbf++5JCqqp4XR3RUMfxzGTAVODzfjTSmrHQbkKTdgGeAXsQS3oZKuI3K9qPA5sCfiXm9R2UDncaTlW4DkbQC0VR8BNGg5o6SQ+oyjVjpVpK0PlH1ziGWYz9XckipSvKvaAMolvB+iWhQ8zrRXLxhE24zsP1XYFvgeuB+ScdlA53GkJVuNydpIPBzYB2iucrYkkOqiUavdCtJGgT8Alie+D/OVYPdWFa63VRR3R5CzEx4gph32xQJt9kU+8/tApwP3CbpDEl9y40qdVQm3W5I0mDgDuBw4FO2T7Y9s+SwUhcqlhJfSUwvWw94QtIny40qdUQm3W6kaFBzLPAQcDMwInu1NhfbU21/ETgeGCPpPElLlR1Xar9Mut2EpCHAA8S8261sn50NappXsU/dEKJR+jOSdi45pNROmXTrnKTekk4G7iKmEO1oe0LJYaU6YPst2wcSw0y/kHSFpOVKDiu1IZNuHSu2+J43YX647V9kg5q0INu3AkOBd4mq94slh5QWIaeM1SFJSwDfB/YH/hO4LvslzK+ZpowtjuLi2mXEisSjbb9WckhpAVnp1hlJOwBPAasQDWp+nQk3tVexr93GwHNEA50Ds4FOfclKt05IWgb4EbAbcKTtm0oOqa5lpds2SRsDlwNvEMvCJ5UbUYKsdOuCpD2Jt4MmGtRkwk2dVqxc2xK4E3hE0jeygU75stItkaQVgXOBLYBDbd9VckjdRla6i0fSJ4BLiULrkKK3QypB/tUrQbGEdz+iQc2rRIOaTLipyxRdyrYDfgXcJ+l7knqVHFZTykq3xiStRjSoGUQ0L3m43Ii6p6x0O07SmsDFwErEz+BjJYfUVLLSrRFJPSQdDjwO/AXYNBNuKoPtl4FdgXOAWySNltSv5LCaRibdGpC0LnEx4yBiy/Pv2/6g5LBSEysa6FwNDAMGEw10ti05rKaQSbcLSeop6VvAg8D/Ap+0Pa7ksFL6kO2/294HOA64TtKFkpYuO65Glkm3i0gaRiTbXYEtbJ9je07JYaW0ULZ/RzTQ6UssJd615JAaVibdKpPUR9KpRL/bi4GdbL9Uclgptcn227YPBg4GfibpaknLlx1Xo8mkW0WStgIeI5Zhbmz70lzCm7ob27cTDXTeIqrevXMpcfXklLEqkLQkcBrwZeCbwPWZbLtWThmrDUkjiAY6zxHL06eWHFK3l5VuJ0n6FLHIYUWiQc1vMuGmRmH7QWA48TP+pKSvZdXbOVnpdpCkAcCPgZ2BI2z/seSQmkpWurUnaSOi6p1GNNDJaxUdkJVuB0jai2hQ8wHRoCYTbmp4tp8EtgJuBR6W9E1JLSWH1e1kpbsYJK0EnEe83TrE9r0lh9S0stItl6SPA5cAvYmlxONLDqnbyEq3HYoGNfsTzcUnARtlwk3NzPbzwA7AVcA9kk6U1LvksLqFrHTbIGkN4CJgVeIv+iMlh5TISreeSFqdmJOevyPtkJVuK4oGNUcSG0PeT/yC5w9TSguwPRnYndj55GZJPyr2+UsLkUl3IYrxqruJjSH/w/YZtmeVG1VK9atooPNLYlHF6sT0su1KDqsuZdKtUDSo+Q7wAPBbYNvssJ9S+9l+3faXgf8Cfinp55L6lx1XPcmkWyjmID4E7ARsbvu8bFCTUsfYvpFooNNCLCXeveSQ6kbTJ11JfSWdDvwJuADY2fbEksNKqduzPc32YcCBwHmSrpW0Qslhla6pk66krYmdHDYgpoFdkUt4U6ou23cSzdL/TlS9+zbzUuKmnDImaSngDGBv4Bjghky23UtOGeueJG0JXA5MIBrovFpySDXXdJWupJ2J5h3LEA1qfpsJN6XasP0QsAnxDvMJSYc2W9XbNJWupGWBnxCraA63fWvJIaVOyEq3+5M0lGig8y5wqO0XSw6pJpqi0pX0BaJBzbtEdZsJN6WS2X4aGAHcDDwk6dhmaKDT0JWupJWJGQlDiAY1fy45pFQlWek2FknrEA10liCWEj9TckhdpiEr3aJBzQFEg5rnia1zMuGmVKdsTwA+RQw33CXp5EZtoNNwSVfSmsAtxLY5n7H9PdvvlxxWSqkNtufa/gXROnUz4FFJW5QcVtV126QraRlJQyq+7iHpaKJBzT3EtuePlRZgSqlDbE8BPgucCdwo6ceVDXQkrSppUEnhdVodJF0NBV0IGg+aCXLx7/ji9qGtPPBSYKykj0laD7gX2BfYxvbobFCTUvdVNND5NdFAZxXgKUk7SOoJ3AHcXny+EB3OKTVR4oU0rQ1cQ2xX3odYo72g2cSWOI8DX4XYk6lYSfYnoBfwIrEp5CnAz2zP7fLQU+nyQlpzkbQH8HNgKrAhYOA42xdUHNXhnFJLJSVd7Q1cSevfmAXNAWYCB0r8DzAO+ETFfUfYvrQLAk11KpNu85G0CfAwH+WMd4FBtt/sTE4Bj6l+tK0rYXhBexNbfCxB+745FMctAVx11llcDKy9wH0/krRMVcNMKdWNYtXaL5g/Zy0BXNDZnFI8vmZqXOlqbWIJboe7yv/rXzB0KJ44kbnAe0QTjYnAAVn1NI+sdJtLsWhi3hjvykB/wGutRcsLL/B+Swt9O3H6GcAQqE13wUVWupImSdqpis93DVH+c8opsP/+i3+Cfv2Y8/TTPAYsZXtp2+vY/vTi/vJJcjEhO6VU52zPsb0P0fP6QqAvMHjsWJ7t0YNenTx9HyI31USHhxdav3LY6iOGEQPcnVrm16MHLUsuyfo263bmPCml7sv2LJtlPvYx1pA6l1OInDS8ZrMabLf6AR++hX8X+DZxxfBg4BXg3uKYrwF/Bd4GbgXWrHj8ucBkYPqgQbx+zz3MtvEtt+BevXDPnnjJJfGwYfGU222Hjz8ejxgRt++xB37jDbzffnjppfFmm+GJE7HNLJsLgPWIWQxvAc8B+1Q895XEX8SbgX8SfyEHF/fdW7yWfxWv7UuL+j7kR/19AH8DBpYdR360+f80CfguML7IEVcAfYv7DiVaPL4F3Djv/xMQcA7wOjCduHD+IPAzYBYx++DdTTdloh05ZWEfP/gBHjgQL7UU/vjH8e23x+0nn4y/+EW8zz5x3/Dh+PHHI6cUzz8QuAH4BzF0eUzF6zkFuB64usgr44hhrnn3DwceW+T3pB3fsJ2KzwcViepqYEmgH7BX8U1bH+gJnAA8UPH4/YHlgZ6nnsprK62E33vvoxf+la/M/5TbbYcHD8YTJuBp0/D66+N118V/+hOeNQuPGoUPPDCOfecdxhcJ/aDiuYcDbwAbFM99JfAmsEVx/y+B6ypiM7BO2T+U+dGxj0y63eOjyCHPEJtVLkfsrH06sGPx+7oJ8fb+fD4q5HYhFjkNKBLwTkWi/WeRhK8HZDO+tad+9lm82mr41Vfj64kTI6/YkXt69sRjxuAPPsBnnYUHDcIzZzKOePf/KHAS0Ju4aP8SsEsR2ynA+8BuRIU8Ghhb3NcbeBn4z0V9TxZziACAU2z/C0DSEcBoF5s3SjoT+J6kNW2/bPvajx6mZc85B557DjbaqPWTH3QQDB4cn++6K4wfDzsVo8p77w0nnhif/+EPfIL4K7QkcETx8GeBsyTdQlTBzxFJdwvgHeALxaq1efaX9EYHvgepfEsAB0l6p+xA0iItDYwlCjSAJ4HDiaT7OLB18TEROFLSScAKRJI+gUhiyxHvupcqzvEF4PU5cxjQ0srAQksLzJwZ+WPFFWHQoPnv33RTGDkyPj/2WDj7bHjwQdYFNgdWtP394tCXJF1CLLya153wz7b/CCDpGqLlAMBWxNqBny7qG9KRpDu54vM1gXMlnV1xm4BVgZclfYsYjhi4zDL0nj4d3mgjxa200kef9+v371+/+24RxGR6AGsBCz73c0TCXYYYOlivuG8V4j9tvYrjBxP/wan76UX8/80oO5C0SL2Iwmje790AYFkiR0xi/t/H94ltfV4jCqivEkl7MvNffxIwoKWl9fy1zjrw05/GBftx42CXXeAnP4GBA+P+1Vf/6NgePWC11WDqVHoSOW2gpGkVp2sB7qv4+rWKz2cAfYtrXAOBV12Uva1pK+ku7MGVt00GznDsdz8fSdsS48CfAsZNm8Z7yy5L73nhdLZX/GqrMRu42/anF3a/pCuBKbZPKL7entjl9+ji66OAUx3djVI3U/RIPsE5ZayuFSvJbrZ9UfH1rsCWwN3Am7a/Xdy+JFEBf8v2pIrHf4wY712buL7Uixii2JMYnmi1E9l++8XH9Olw+OHwne/ANcUchckVpePcuTBlCqyyCrOJnDbRdkcu1E8FVpWkRSXetmYv/J35FyIs6CLgu5I2hA+b0MybaLw0seTuH0DP73yHd6ZP/+iBK60EkybFC+6I3XdnAvBxSaMk9So+Npe0fjtP0dZrSylVx1GSVpO0HHA88Btizu1BkjaW1IdobvOQ7UnF7/GWknoRF7v/RVSUZxJjv3+z/U+iBcBCPfcc3HlnDDH07RvvkntUZLtHH4X/+R+YPTsq4j59YMQIXiBWvP1T0nck9ZPUImmIpM3b8TofJHLeMYs6qK2kOxo4oSi1Ry54p+3fAT8ErpM0nRgw37W4+1bg/4h+ti+/8w4TKkv6vYvUvPzysMkmbb6YBc0eMIA7gJ2JsZa/ESX/DynmAbfDKcBVkqZJ2mexI0gptdevgNuIC1IvAqfbvh04kZglMJUYKtq3OL4/0dD8bWJM9zXiounpRP+FDSRN22IL+hJJ7t/MnAnHHQcrrAArrwyvvw6jR390/157wW9+A8suG9XvDTcwu3dv7rI9B9iDmN46kaimLyWGKxfJ9gfEePOBizquhivSNIz4S9Dh1Wjz2MyQ2Ar8dOfjSt1RrkjrHiRNInZtub3a5541S8N69mSsRL/Fedwpp8CECXDttfPdPANqk1Nq2HvBTwFPEI0mOmz2bHjgAZaQuFPSk5JulPSj4q1LSqkBFf2yj5c0RtIjkqb27s1jDzxAv7lzO5dTiJz0eK2KuI7MXuiMUXSy98LcucweNQoRsw5WIK527sz8sxhSSo3FwGHAGpU3brstc5dY4t9XpI0fD2usseCtrZpJ5KaaKKG144cdgRbrLUHhvenTOWSZZTgH+Fhx2yzg27YXOTcuNZYcXmg+kj4J3AUf9lp4D9jQZjM6kVOAA2rZ3rHWlS7x4gQd7H3Zv7/HgGYA1xLf5OnA/5M0zvafuibmlFKZJG0A/Ji4sLUsUfmea3siMLEzOaUJ+ulC8SKHEitVZtDKFcji9hnFcUMqvjn/S6xsmUOsZvk6cKmkyyQt25WRp5RqR1JvSScS+x5eRWxeMJ2YRnbaR0d2OqfUTInb9XwYwlBiUvQOwDrEW4dZRE+Hu4CLFzbAXez6u2HFcryliSlunweOLqazpQaVwwuNT9JmxJbsU4jdYSYXtw8H+tge28ojO5RTaqUOkm51FSvhLgWeAr5h+7U2HpK6oUy6javY+fcU4ADgWOBXbS2t7U7qYDfg6rJ9H7AR8VftSUlfLbb6SCnVOUnbEUOHqwNDbf+ykRIuNGClW6nYyO4yYsnv4bZfLjmkVCVZ6TYWSf2JFaV7AkfavrHkkLpMw1W6lWw/RrR1vBd4VNJRkhr6NafU3UjanWgh0AIMaeSECw1e6VaStB5R9c4lliU+V3JIqROy0u3+JK1A9J4dARxq+86SQ6qJpqn6bD8LbEt0OPqzpOOKLkYppRpS2Jeobv9OjN02RcKFJqp0K0kaBFwMrAgcbPvxUgNKiy0r3e5J0qrEXmeDid+9h0oOqeaaptKtVDRJ/gyxceatks6U1LfcqFJqXEV1eyjR9OpxYJNmTLjQpEkXwOEqomHOx4EnirXdKaUqkjQYuIPY/XdH26cUvWebUtMm3Xlsv2Z7JNHRfoyk84vVbSmlTih2XTgWeAj4AzDCzh7YTZ9057F9A7AhsYne05J2KTmklLotSUOAB4hdGLa0/ZNiV4aml0m3gu23bX+N6Nt5kaQrszl6Su1XNKg5mehxcCnwKdut7mXWjDLpLoTt24iORe8Az0j6YskhpVT3JG0BPApsCmxs+5JGW8JbDU05ZWxxFBfXLgXGE93LppYcUiKnjNWTokHNacBXgG8Cv8lk27qsdNtg+35gOPBXooHOQdlAJ6UgaQdiC66ViCW812XCXbSsdBeDpI2JpcRvAocV831TCbLSLZekZYCziPnuX7d9c8khdRtZ6S4G208AWxJzDh+RdIyk9mwNklLDkLQnsYR3DlHdZsJdDFnpdpCkjxNjvS1EA52/lhxSU8lKt/YkrQicB2xG/MzfU3JI3VJWuh1k+3lge+CXwL2Sjs8GOqkRFUt49yPGbicDG2XC7bisdKtA0hrARcBAoonHoyWH1PCy0q0NSasDPwfWAL5m+5GSQ+r2stKtAtuvALsTW0T/UdIPJPUrOayUOkxSD0lHAI8RO+dulgm3OjLpVknRQOdaYlHFWsT0sv8oOayUFpukdYE7iY0ht7N9ejM3qKm2TLpVZvt1218Cvg38StKFxf5PKdU1ST0l/TfwIPA7YBvb40sOq+Fk0u0itn8PDAH6EA10di05pJRaJWkYkWx3AbawfW42qOkamXS7kO1ptg8BvgZcKOlqScuXHVdK80jqI+n7wO3EBbNP236p5LAaWibdGrB9BzHW+wbRQGefXEqcyiZpK+JC2VCiQc3luYS36+WUsRorftAvA14AjswpTx2TU8Y6TtKSwOnAvsAxwG8z2dZOVro1ZnsssAnwJLFF0MFZ9aZakbQTschhOWIJ75hMuLWVlW6JiosXlwHTgUNzLK39stJdPJIGAGcDOwFH2L6l5JCaVla6JbL9FDACuAV4WNI3s4FOqjZJnwPGAe8R1W0m3BJlpVsnJK1DNNDpSywlHldySHUtK922SVoJOB/YiGhQc1/JISWy0q0bticAOwKXA3dLOlFS75LDSt1Q0aBmFPAU8CLRoCYTbp3ISrcOSVqNaKCzBlH1/qXkkOpOVroLVzRfuhhYmfjZeazkkNICstKtQ7anAHsCo4GbJJ1V7EOV0kIVDWqOJDaGvI9YVZYJtw5l0q1TRQOdXxMT11clGuhsX25UqR5J+gRwD7Ex5La2z7Q9q+SwUisy6dY52/+wvR9wLHCNpIuK/alSkysa1BwH3A9cTyTcZ0sOK7Uhk243YfsmooEORAOd3cuMJ5Wr2CT1IWAHYmz7fNtzSw4rtUMm3W7E9ju2jyD6nJ4r6ZfFvlWpSUjqK+kM4FZiv7LP5K7U3Usm3W7I9l3AMOBvRNX75VxK3PgkfRJ4AvgEMQ3sqlzC2/3klLFuTtIWxFLiScDXi5kPDa+ZpoxJWgo4ExgJfMP2DSWHlDohK91uzvbDwKbAX4DHJR0mKf9fG4SknYFngKWJJbyZcLu5rHQbiKQhRNU7g2igM6HkkLpMo1e6kpYjGtTsABxm+7aSQ0pVkhVRA7H9DLA1cCMwVtJ/SepZclhpMUn6IlHdTieq20y4DSQr3QYlaW3gEuJt6cG2ny45pKpqxEpX0irABcAGRIOa+0sOKXWBrHQbVNGbdyfgF8Cdkk6V1KfksNJCFA1qDiQa2/8VGJ4Jt3Fl0m1gxVLiS4GNi49HJW1ZclipgqRBxJzbY4CdbZ9g+/1Sg0pdKpNuE7D9KvA54DTg95J+UuyTlUpSNKj5BjHr5A6iQc0TJYeVaiCTbpMoqt7fEA10VgSekrRjyWE1JUnrE53A9gG2sf1D27NLDivVSCbdJmP7DdujiLezV0q6pNg/K3UxSb0kHU8k3F8C29l+ruSwUo1l0m1Stm8mGujMAp6RtFfJITU0SZsQQwnbAJvY/lk2qGlOmXSbmO3pto8E9gPOknSdpI+VHVcjkdRP0g+IzUfPBnaz/UrJYaUSZdJN2L6X2LzwZaKBzv7ZQKfzJG1LNKhZCxhm+5psUJNycUSaj6TNiKXEU4AjbE8uOaSFqufFEZL6E1stfQ44yvbvSw4p1ZGsdNN8bD8CbAY8CDwm6evZQKf9JO0KPA30IZbwZsJN88lKN7VK0gZE1TuLWJb6fMkhfajeKl1JywPnEBfKDrN9e8khpTqVFUxqle3xRBK5AXhA0rezgc78iiW8+xANat4EhmbCTYuSlW5qF0lrEX0clgO+ZvvJkuMpvdKVNBD4GbAu8U7gwbJiSd1HVrqpXWxPBHYmumD9SdLpkvqWHFYpiur2YGJmwlPEvNtMuKldMummdiuWEl9BTC/bgNipYuuSw6qpomXm7cDXgZ1sn2R7ZslhpW4kk25abLanAl8ETgR+K+ncYh+vhiWpRdI3gYeB/wO2sv1UyWGlbiiTbuqQour9LdFAZwCxqOLTJYfVJSRtCNwPfB4YYfusbFCTOiqTbuoU22/aPoB4u32ppMslLVt2XNUgqbekk4C7gSuBHWy/UGpQqdvLpJuqwvb/EQ10ZgDjJH2h5JA6RdLmwCPAlsSFsouyQU2qhpwylqqu6DlwKbEy62jbr1XpvAIGE8XCfcS48uvARNuzqvQcSwCnAqOAY4FfZ7+EVE1Z6aaqs30fMcPheaJZ+gFVaqCzMfAC8CjRiP0WYk+xr1bh3EjantinbDVikcOvMuGmastKN3WpomGRh88AAAYTSURBVI/sZcDfgcNtv9yJc4lY+bVBxc3vAqvant6J8y4D/BDYAzjS9o0dPVdKbclKN3Up248BWwD3EBtjHt3RBjpF1fktItECvA/8uJMJdw8ikfcANsyEm7paVrqpZiStR1S9JpbNPtuBc1RWu/8CBnYk6UpaETiXuFB2qO07F/ccKXVEVrqpZookuy1wHfBnSd+T1GsxzzGv2gW4aHETbrGE98vERb6pxNhtJtxUM1npplJIGgRcDHyMaKDzeDseNRQ4wmaH2bNZr1cvBHwAvAjcBVwEfnoRz7ka8HNiJ4eDbT/UyZeR0mLLpJtKUwwVfBU4ixh2ONX2+ws5cm3gGmL2Qh+gZSGnm00k4MfjnH6p4nl6AIcAZxANe0bb/qCaryWl9sqkm0onaWXgfGAYUYH+ueLevYnVYK0l2wXNAWYCB4LHSFoHuARYojj3M9WMPaXFlWO6qXS2X7O9N/Bd4HpJF0hauki4VxEJsz0Jl+K4JWyuGj1aVwNjgZuArTPhpnqQlW6qK0XfhrPXXZdd/vpXlm9poU9Hz/X++8w9+2x2PP5431Ol2CYRsy5yZ4jUYZl0U1164w2NW3ZZ1mtp6fi7MZs5EmPB21Qjpky6qRpyeCHVTPv3V9OwFVZgUGcSbjwfLcDwYtZDSnUhk27qNEmTJH1X0nhJb0u6QlJfSdtLmiLpO5JeA66Q1EPScZJelPSmpOslLbfAKQ+Hj4YV3n8f9t8fll8eBgyAzTeHv/897tt+e/jud2GLLaB/f9hrL3jrrY9O9OCD9Fl3XW6TNE3Sk0V/hXlx3y3pNEn3S/qnpNskrVBx/yhJLxdxHt8F37rUhDLppmr5CrAL0QXs48AJxe0rE5tZrgkcBnwD+BywHTAQeBu4cIFz7UDFhbOrroJ33oHJk+HNN+Gii6Bfv48OvvpquPxymDoVevaEY46J2199FfbYg5bRo/mgiOFbwA3FarR59gMOIuYL9y6Ombf9/M+JbmMDgeWJRjgpdUom3VQtF9iebPstYj7sl4vb5wIn255p+z3gCOB421OKvcVOAUYuMPQwuPLEvXpFsp0wAVpaYNNNo6qdZ9QoGDIEllwSTjsNrr8e5syBa6+F3XaDkSNZ2fZc238ieuTuVnH6K2w/X8R2PTEXGGAk8Afb9xZxnli8lpQ6JZNuqpbJFZ+/TFSHAP9YYMHDmsDvirf704jWjHOAlSqO6V154lGjYJddYN99YeBA+Pa3YVZF99zVV684+Zpx3xtvwMsvw5gxMGAAvSuebxtglYrTV/b6nQHM2+ttYOVrsv0v4M02vwsptSGTbqqWitTHGsDfis8XnB4zGdjV9oCKj762X604Zr7VYr16wcknw/jx8MAD8Ic/xJDChyesSPevvBLHr7BCJONRo2DaND6oeK4lbf+gHa9nauVrKpqbL9+Ox6W0SJl0U7UcJWm14qLY8cBvWjnuIuAMSWtCdPuStNcCx7xY+cVdd8HTT8eQQf/+kVR7VPzkXnttJOQZM+Ckk2DkyBiG2H9/uOkm+N3vmFrs5jvv4l57xmZ/C+whaRtJvYHvk78vqQryhyhVy6+A24CXiKR5eivHnQvcCNwm6Z/EirEtFzjmLqKXAgCvvRaJtH9/WH992G67qGDnGTUKDjwQVl45Zjqcd17cvvrq8PvfM+d736MX8A+iyv5v2vFzb3sccFTxuqYSF/ymtPW4lNqSiyNSp1V/0YCGAQ8Sy38Xafvto6I95JBWD5kBbLWo7mMp1VJWuqkO+SngCeICW2fMAR7PhJvqSSbdVBckfUXSu/M+evRg46WWomXDDTt12pnEPNuU6kYOL6Q69mGXsX5tHbkQ7wEHgMdUN6aUOqeda+FTKoPHgKAT/XS7LLSUOigr3dQNaG3gamA4sXBiYcVC5c4Ro8ATaxdfSu2XSTd1IxpKNMPZAVgH6AXMAiYQ08wuzotmqd5l0k0ppRrK2QsppVRDmXRTSqmGMummlFINZdJNKaUayqSbUko1lEk3pZRqKJNuSinVUCbdlFKqoUy6KaVUQ5l0U0qphjLpppRSDWXSTSmlGsqkm1JKNZRJN6WUauj/A/N2LzrFWJsFAAAAAElFTkSuQmCC%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our causal model states what we described above: Pre-signup spend influences both rewards signup (treatment assignment) and post-signup spend. This is the story about our high and low spenders.</p>
<p>Treatment (rewards signup) influences post-signup spending behaviour - this is the effect we're actually interested in.</p>
<p>We also added a node <code>U</code> to signify possible other confounding factors that may exist in reality but weren't observed as part of our data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Identification-/-identifying-the-causal-effect">
<a class="anchor" href="#Identification-/-identifying-the-causal-effect" aria-hidden="true"><span class="octicon octicon-link"></span></a>Identification / identifying the causal effect<a class="anchor-link" href="#Identification-/-identifying-the-causal-effect"> </a>
</h2>
<p>We will now apply do-calculus to our causal model from above to figure out ways to cleanly estimate the treatment effect we're after:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">(</span><span class="n">proceed_when_unidentifiable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Estimand type: nonparametric-ate

### Estimand : 1
Estimand name: backdoor
Estimand expression:
     d                                         
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(Expectation(post_spend|pre_spend))
d[treatment]                                   
Estimand assumption 1, Unconfoundedness: If Uâ†’{treatment} and Uâ†’post_spend then P(post_spend|treatment,pre_spend,U) = P(post_spend|treatment,pre_spend)

### Estimand : 2
Estimand name: iv
No such variable found!

### Estimand : 3
Estimand name: frontdoor
No such variable found!

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Very broadly and sloppily stated there a three ways to segment (or slice and dice) our observational data to get to subsets of our data within which we can cleanly compute the average treatment effect:</p>
<ul>
<li>Backdoor adjustment,</li>
<li>Frontdoor adjustment, and</li>
<li>Instrumental variables.</li>
</ul>
<p>The above printout tells us that based on both the causal model we constructed and our observational data there is a backdoor-adjusted estimator for our desired treatment effect.</p>
<p>This backdoor adjustment actually follows closely what we already said above: We'll compute the post-spend given pre-spend (segment our customers based on their spending behaviour).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Estimating-the-treatment-effect">
<a class="anchor" href="#Estimating-the-treatment-effect" aria-hidden="true"><span class="octicon octicon-link"></span></a>Estimating the treatment effect<a class="anchor-link" href="#Estimating-the-treatment-effect"> </a>
</h2>
<p>There are various ways to perform the backdoor adjustment that DoWhy identified for us above. One of them is called propensity score matching:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
    <span class="n">identified_estimand</span><span class="p">,</span>
    <span class="n">method_name</span><span class="o">=</span><span class="s2">"backdoor1.propensity_score_matching"</span><span class="p">,</span>
    <span class="n">target_units</span><span class="o">=</span><span class="s2">"ate"</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/sklearn/utils/validation.py:760: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().
  y = column_or_1d(y, warn=True)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>*** Causal Estimate ***

## Identified estimand
Estimand type: nonparametric-ate

## Realized estimand
b: post_spend~treatment+pre_spend
Target units: ate

## Estimate
Mean value: 159.15597747093042

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DoWhy provides us with an estimated ATE for our observational data that is pretty close to the ATE we computed for our experimental data from our randomized controlled trial.</p>
<p>Even if the ATE estimate DoWhy provides doesn't match exactly our experimental ATE we're now in a much better position to take a decision regarding our rewards program based on our observational data.</p>
<p>So next time we want to base decisions on observational data it'll be worthwhile defining a causal model of the underlying data-generating process and using a library such as DoWhy that helps us identify and apply adjustment strategies.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="waltherg/georgio_fastpages"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/2021/08/18/Causal_inference_for_decision_making_in_growth_hacking_and_upselling_in_Python" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My personal blog on tech and data</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/waltherg" target="_blank" title="waltherg"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/georgwalther" target="_blank" title="georgwalther"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/GeorgRWalther" target="_blank" title="GeorgRWalther"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
